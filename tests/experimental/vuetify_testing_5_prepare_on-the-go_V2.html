<!DOCTYPE html>
<html>
  <head>
  <link
    href="https://cdn.jsdelivr.net/npm/@mdi/font@4.x/css/materialdesignicons.min.css"
    rel="stylesheet"
    />
  <link
    href="https://cdn.jsdelivr.net/npm/vuetify@3.0.5/dist/vuetify.min.css"
    rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/d3@4"></script>
</head>
  <body>
    <script type="module">
      window.addEventListener("DOMContentLoaded", () => 
        import("https://unpkg.com/mathlive?module").then((mathlive) => 
          mathlive.renderMathInDocument()
        )
      );
    </script>
    <div id="app"></div>
      <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/vuetify@3.0.5/dist/vuetify.min.js"></script>
      <script type="text/x-template" id="app-template">
      <v-app>
        <v-layout class="rounded rounded-md">
          <v-navigation-drawer
            image="https://cdn.vuetifyjs.com/images/backgrounds/bg-2.jpg"
            theme="dark"
            permanent
            :rail="v_rail"
            >
            <v-list nav>
              <v-list-item prepend-icon="mdi-home" title="Home" value="Home" @click.stop="v_rail = !v_rail"></v-list-item>
              <v-list-item prepend-icon="mdi-file-cabinet" title="Access Scenario" value="AccessScenario" @click.stop="v_rail = !v_rail"></v-list-item>
              <v-list-item prepend-icon="mdi-movie-open" title="Run a Scenario" value="RunScenario" @click.stop="v_rail = !v_rail"></v-list-item>
              <v-list-item prepend-icon="mdi-run-fast" title="Prepare on-the-go" value="OnTheGo"  @click.stop="v_rail = !v_rail"></v-list-item>
              <v-list-item prepend-icon="mdi-database-edit" title="Work on a Database" value="WorkOnDatabase"  @click.stop="v_rail = !v_rail"></v-list-item>
              <v-list-item prepend-icon="mdi-book-open-outline" title="Access Documentation" value="AccessDocumentation" @click.stop="testMethod"></v-list-item>
              <v-list-item prepend-icon="mdi-handshake" title="Culture Hints" value="CultureHints" @click.stop="testMethod"></v-list-item>
              <v-list-item prepend-icon="mdi-unfold-more-vertical" title="" value="ExpandMinimize" @click.stop="testMethod"></v-list-item>
            </v-list>
          </v-navigation-drawer>
      
          <!--v-app-bar title="Application bar"></v-app-bar-->
          <v-main class="d-flex "> <!-- align-center justify-center -->
            <!--Main Content-->
            <v-container class="white">
              <v-row class="mb-3" no-gutters>
                <v-col cols="6" class="bg-red">
                  First left
                  <v-table density="compact">
                    <tbody>
                      <tr>
                      Scenario name here + associated database
                      </tr>
                    </t-body>  
                  </v-table>  
                  <!-- here the sub container starts -->
                  <v-container>
                    <v-row style="min-height: 100px;" class="bg-pink">
                      <v-col cols="10">
                        <v-table density="compact">
                          <tbody>
                            <tr>
                              <v-select  density="compact" label="Select Sender" :items="['Country A', 'Region A', 'City A']"></v-select>
                              <v-select  density="compact" label="Select Receiver" :items="['Country B', 'Region B', 'City B']"></v-select>
                            </tr>
                          </t-body>  
                        </v-table>  
                      </v-col>
                      <v-col cols="2">
                        <v-btn density="comfortable" icon="mdi-content-save-outline" :ripple="true">
                          <v-icon color="black"></v-icon>
                          <v-tooltip
                          activator="parent"
                          location="top"
                        >Save</v-tooltip>
                        </v-btn>
                        <v-btn density="comfortable" icon="mdi-printer" :ripple="true">
                          <v-icon color="black"></v-icon>
                            <v-tooltip
                          activator="parent"
                          location="top"
                        >Print</v-tooltip>
                        </v-btn>
                      </v-col>
                    </v-row>
                    <v-row style="min-height: 50px;" class="bg-orange">
                      <v-col cols="12">
                        <v-btn block prepend-icon="mdi-traffic-light" :ripple="true" density="comfortable">
                          <template v-slot:prepend>
                            <v-icon color="black"></v-icon>
                            <v-tooltip
                            activator="parent"
                            location="top"
                          >Get ready</v-tooltip>
                          PREPARE
                          </template>
                        </v-btn>
                    </v-row>
                    <v-row style="min-height: 600px;" class="bg-blue">
                      <v-col cols="12">
                        Gap Chart
                        <div id="d3app"> </div>
                        <canvas id="mycanvas" width="200px" height="600px"></canvas>
                      </v-col>
                    </v-row>
                  </v-container>
                  <!-- here the subcontainer ends -->
                </v-col>
                <v-col cols="4" class="bg-green">
                  Second
                  <v-sheet class="pa-2 ma-2" :elevation="4" :height="672" :width="350" border color="bg-surface-variant" rounded>
                    Miscommunication: Cumulative and Incremental
                    <v-table density="compact">
                      <tbody>
                        <tr>
                          <td>Cumulative risk</td>
                          <td>72%</td>
                          <td>High</td>
                        </tr>
                      </t-body>  
                    </v-table>  
                    <v-table density="compact">
                      <thead>
                        <tr>
                          <th class="text-left">
                            Characteristic
                          </th>
                          <th class="text-left">
                            Probability
                          </th>
                          <th class="text-left">
                            Risk Level
                          </th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td>Shared understanding</td>
                          <td>65%
                            <div id="d3pie1"> </div>
                          </td>
                          <td>Elevated</td>
                        </tr>
                        <tr>
                          <td>Performance feedback</td>
                          <td>73%
                            <div id="d3pie2"> </div>
                          </td>
                          <td>High</td>
                        </tr>
                        <tr>
                          <td>Inflencing narrative</td>
                          <td>70%</td>
                          <td>High</td>
                        </tr>
                        <tr>
                          <td>Leadership style</td>
                          <td>75%</td>
                          <td>High</td>
                        </tr>
                        <tr>
                          <td>Decision-making</td>
                          <td>75%</td>
                          <td>High</td>
                        </tr>
                        <tr>
                          <td>Relationship foundation</td>
                          <td>70%</td>
                          <td>High</td>
                        </tr>
                        <tr>
                          <td>Conflict resolution</td>
                          <td>73%</td>
                          <td>High</td>
                        </tr><tr>
                          <td>Time management</td>
                          <td>74%</td>
                          <td>High</td>
                        </tr>
                      </tbody>
                    </v-table>
                  </v-sheet>
                </v-col>
                <v-col cols="2" class="bg-yellow">
                  Notes
                  <v-sheet class="pa-2 ma-2" :elevation="4" :height="672" :width="150" border color="bg-surface-variant" rounded>
                    <v-textarea
                          :model-value="value"
                          label="Notes"
                          rows="1"
                          no-resize
                          bg-color="white"
                        ></v-textarea>
                  </v-sheet>
                </v-col>
                <!--v-col align-self="end" cols="6">
                  <v-sheet class="pa-2 ma-2" :elevation="4" :height="672" :width="300" border color="bg-surface-variant" rounded>
                    Sheet 2 third
                  </v-sheet>
                </v-col-->
              </v-row>
            </v-container>
          </v-main>
        </v-layout>
      </v-app>
    </script>
    <script>
      // Vue Section
      const { createApp } = Vue;
      const { createVuetify } = Vuetify;

      const vuetify = createVuetify();
      const app = createApp({
        template: "#app-template", 
        data() {
          return {
            v_rail: false
          }
        },
        /*computed: {
          items() {
            return this.$store.state.items;
          },
          name() {
            return this.$store.state.name;
          }
        },*/
        methods: {
          testMethod() {
            console.log('Dies ist ein Test');
            this.v_rail = !this.v_rail
          }/*,
          boop() {
            console.log('booop');
            console.log('test', this.test);
          },*/
        }
      })
        .use(vuetify)
        .mount("#app");
    </script>
    <script>
assignpieInfo("d3pie1", 65);
assignpieInfo("d3pie2", 73);

function assignpieInfo(selector, percentValue) {
            // set the dimensions and margins of the graph
      var width = 120
          height = 120
          margin = 10

      // The radius of the pieplot is half the width or half the height (smallest one). I subtract a bit of margin.
      var radius = Math.min(width, height) / 2 - margin

      // append the svg object to the div called 'my_dataviz'
      //var svg = d3.select("#d3pie2")
      var svg = d3.select("#" + selector)
        .append("svg")
          .attr("width", width)
          .attr("height", height)
        .append("g")
          .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

      // Create dummy data
      var data = {a: 73, b: 27/*, c:0, d:0, e:0*/}
      data.a = percentValue;
      data.b = 100-percentValue;

      // set the color scale
      var color = d3.scaleOrdinal()
        .domain(data)
        //.range(["#98abc5", "#8a89a6", "#7b6888", "#6b486b", "#a05d56"])
        .range(["#98abc5", "#8a89a6"])

      var fillopacity = d3.scaleOrdinal()
            .domain(data)
            .range(["1", "0"])

      // Compute the position of each group on the pie:
      var pie = d3.pie()
        .value(function(d) {return d.value; })
      var data_ready = pie(d3.entries(data))

      // shape helper to build arcs:
      var arcGenerator = d3.arc()
        .innerRadius(0)
        .outerRadius(radius)

      // Build the pie chart: Basically, each part of the pie is a path that we build using the arc function.
      svg
        .selectAll('whatever')
        .data(data_ready)
        .enter()
        .append('path')
        .attr('d', d3.arc()
          .innerRadius(0)
          .outerRadius(radius)
        )
        .attr('fill', function(d){ return(color(d.data.key)) })
        .attr("fill-opacity", function(d){ return(fillopacity(d.data.key)) })
        .attr("stroke", "black")
        .style("stroke-width", "1px")
        .style("opacity", 0.7)

        svg
        .selectAll('mySlices')
        .data(data_ready)
        .enter()
        .append('text')
        .text(function(d, i){ if (i == 0) { return d.data.value } })
        .attr("transform", function(d) { return "translate(" + arcGenerator.centroid(d) + ")";  })
        .style("text-anchor", "middle")
        .style("font-size", 17)
}
    </script>
    <script>
      var margin = {top: 50, right: 20, bottom: 10, left: 105},
        width = 500 - margin.left - margin.right,
        height = 800 - margin.top - margin.bottom;
    
      var y = d3.scale.ordinal()
        .rangeRoundBands([0, height], .3);
    
      var x = d3.scale.linear()
        .rangeRound([0, width]);
    
      var color = d3.scale.ordinal()
        .range(["#c7001e", "#f6a580", "#cccccc", "#92c6db", "#086fad"]);
    
      var xAxis = d3.svg.axis()
        .scale(x)
        .orient("top");
    
      var yAxis = d3.svg.axis()
        .scale(y)
        .orient("left")
    
      var svg = d3.select("#d3app").append("svg")
        .attr("viewBox", "0,0,800,800")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .attr("id", "d3-plot")
      .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
    
      color.domain(["Strongly disagree", "Disagree", "Neither agree nor disagree", "Agree", "Strongly agree"]);
    
      // Content of csv file
      /*
      Question,1,2,3,4,5,N
      Question 1,24,294,594,1927,376,3215
      Question 2,2,2,0,7,0,11
      Question 3,2,0,2,4,2,10
      Question 4,0,2,1,7,6,16
      Question 5,0,1,3,16,4,24
      Question 6,1,1,2,9,3,16
      Question 7,0,0,1,4,0,5
      Question 8,0,0,0,0,2,2
    */
    
      d3.csv("https://raw.githubusercontent.com/wpoely86/D3.js-Diverging-Stacked-Bar-Chart/master/raw_data.csv", function(error, data) {
    
        data.forEach(function(d) {
            // calc percentages
            d["Strongly disagree"] = +d[1]*100/d.N;
            d["Disagree"] = +d[2]*100/d.N;
            d["Neither agree nor disagree"] = +d[3]*100/d.N;
            d["Agree"] = +d[4]*100/d.N;
            d["Strongly agree"] = +d[5]*100/d.N;
            var x0 = -1*(d["Neither agree nor disagree"]/2+d["Disagree"]+d["Strongly disagree"]);
            var idx = 0;
            d.boxes = color.domain().map(function(name) { return {name: name, x0: x0, x1: x0 += +d[name], N: +d.N, n: +d[idx += 1]}; });
          });
    
          var min_val = d3.min(data, function(d) {
                  return d.boxes["0"].x0;
                  });
    
          var max_val = d3.max(data, function(d) {
                  return d.boxes["4"].x1;
                  });
    
          x.domain([min_val, max_val]).nice();
          y.domain(data.map(function(d) { return d.Question; }));
    
          svg.append("g")
              .attr("class", "x axis")
              .call(xAxis);
    
          svg.append("g")
              .attr("class", "y axis")
              .call(yAxis)
    
          var vakken = svg.selectAll(".question")
              .data(data)
            .enter().append("g")
              .attr("class", "bar")
              .attr("transform", function(d) { return "translate(0," + y(d.Question) + ")"; });
    
          var bars = vakken.selectAll("rect")
              .data(function(d) { return d.boxes; })
            .enter().append("g").attr("class", "subbar");
    
          bars.append("rect")
              .attr("height", y.rangeBand())
              .attr("x", function(d) { return x(d.x0); })
              .attr("width", function(d) { return x(d.x1) - x(d.x0); })
              .style("fill", function(d) { return color(d.name); });
    
          bars.append("text")
              .attr("x", function(d) { return x(d.x0); })
              .attr("y", y.rangeBand()/2)
              .attr("dy", "0.5em")
              .attr("dx", "0.5em")
              .style("font" ,"10px sans-serif")
              .style("text-anchor", "begin")
              .text(function(d) { return d.n !== 0 && (d.x1-d.x0)>3 ? d.n : "" });
    
          vakken.insert("rect",":first-child")
              .attr("height", y.rangeBand())
              .attr("x", "1")
              .attr("width", width)
              //.attr("fill-opacity", "0.5")
              .attr("fill-opacity", "0")
              .style("fill", "#F5F5F5")
              .attr("class", function(d,index) { return index%2==0 ? "even" : "uneven"; });
    
          svg.append("g")
              .attr("class", "y axis")
          .append("line")
              .attr("x1", x(0))
              .attr("x2", x(0))
              .attr("y2", height);
    
          var startp = svg.append("g").attr("class", "legendbox").attr("id", "mylegendbox");
          // this is not nice, we should calculate the bounding box and use that
          var legend_tabs = [0, 120, 200, 375, 450];
          var legend = startp.selectAll(".legend")
              .data(color.domain().slice())
            .enter().append("g")
              .attr("class", "legend")
              .attr("transform", function(d, i) { return "translate(" + legend_tabs[i] + ",-45)"; });
    
          legend.append("rect")
              .attr("x", 0)
              .attr("width", 18)
              .attr("height", 18)
              .style("fill", color);
    
          legend.append("text")
              .attr("x", 22)
              .attr("y", 9)
              .attr("dy", ".35em")
              .style("text-anchor", "begin")
              .style("font" ,"10px sans-serif")
              .text(function(d) { return d; });
    
          d3.selectAll(".axis path")
              .style("fill", "none")
              .style("stroke", "#000")
              .style("shape-rendering", "crispEdges")
    
          d3.selectAll(".axis line")
              .style("fill", "none")
              .style("stroke", "#000")
              .style("shape-rendering", "crispEdges")
    
          var movesize = width/2 - startp.node().getBBox().width/2;
          d3.selectAll(".legendbox").attr("transform", "translate(" + movesize  + ",0)");
    
          // print the svg in a canvas
          //var element = document.getElementById('d3-plot');
          //var svgAsString = new XMLSerializer().serializeToString(element);
          //canvg(document.getElementById('mycanvas'), svgAsString );
      });
    
        </script>
    <script>
      /*
      var testdate = [
          {
            rating: 1,
            items: ["Duration"]
          },
          {
            rating: 3,
            items: ["Duration"]
          },
          {
            rating: 3,
            items: ["Duration"]
          },
          {
            rating: 5,
            items: ["Duration"]
          },
          {
            rating: 5,
            items: ["Duration"]
          },
          {
            rating: 1,
            items: ["Duration"]
          },
          {
            rating: 4,
            items: ["Duration", 'Testing']
          },
          {
            rating: 4,
            items: ["Audience"]
          },
          {
            rating: 1,
            items: ["Audience"]
          },
          {
            rating: 5,
            items: ["Reasoning", "Reasoning"]
          },
          {
            rating: 2,
            items: ["Audience", "Reasoning", "Duration", "Slides"]
          },
          {
            rating: 1,
            items: ["Duration", "Slides"]
          },
          {
            rating: 4,
            items: ["Audience", "Slides"]
          },
          {
            rating: 5,
            items: ["Reasoning"]
          },
          {
            rating: 2,
            items: ["Speed", "Reasoning"]
          },
          {
            rating: 5,
            items: ["Slides", "Audience"]
          },
          {
            rating: 3,
            items: ["Slides"]
          },
          {
            rating: 1,
            items: ["Speed", "Duration", "Slides"]
          },
          {
            rating: 5,
            items: ["Agenda", "Slides"]
          },
          {
            rating: 5,
            items: ["Speed", "Audience"]
          },
          {
            rating: 3,
            items: ["Speed", "Tone"]
          },
          {
            rating: 5,
            items: ["Tone", "Slides"]
          },
          {
            rating: 6,
            items: ["Tone", "Slides"]
          },
          {
            rating: 6,
            items: ["Testing"]
          }
        ];

      // reshape data
      //const data = getData().reduce((result, { rating, items }) => {
      const data = testdate.reduce((result, { rating, items }) => {
        return items.reduce((res, item) => {
          const foundIndex = res.findIndex(
            (r) => r.name === item && r.category === rating
          );

          if (foundIndex !== -1) {
            res[foundIndex].value++;
            return res;
          }
          return [...res, { name: item, category: rating, value: 1 }];
        }, result);
      }, []);

      const options = {
        format: "",
        negative: "← Do less",
        positive: "Do more →",
        negatives: [1, 2, 3, 4],
        positives: [5, 6],
        colors: {
          1: "#63171B",
          2: "#F56565",
          3: "#ED8936",
          4: "#ECC94B",
          5: "#48BB78",
          6: "#00FF00"
        }
      };

      const maxCountOfTypes = data.reduce((result, { name, value }) => {
        result[name] = value + (result[name] ? result[name] : 0);
        return result;
      }, {});
      const maxCountOfAType = Math.max(...Object.values(maxCountOfTypes));

      const width = 750;

      const margin = { top: 50, right: 30, bottom: 0, left: 80 };
      const signs = new Map([
        ...options.negatives.map((d) => [d, -1]),
        ...options.positives.map((d) => [d, +1])
      ]);
      const series = d3
        .stack()
        .keys([].concat(options.negatives.slice().reverse(), options.positives))
        .value(
          ([, value], category) => signs.get(category) * (value.get(category) || 0)
        )
        .offset(d3.stackOffsetDiverging)(
        d3.rollups(
          data,
          (data) =>
            d3.rollup(
              data,
              ([d]) => d.value,
              (d) => d.category
            ),
          (d) => d.name
        )
      );

      const bias = d3
        .rollups(
          data,
          (v) => d3.sum(v, (d) => d.value * Math.min(0, signs.get(d.category))),
          (d) => d.name
        )
        .sort(([, a], [, b]) => d3.ascending(a, b));

      const height = bias.length * 33 + margin.top + margin.bottom;

      const getColor = (key) => {
        return options.colors[key];
      };

      const x = d3
        .scaleLinear()
        .domain(d3.extent(series.flat(2)))
        .rangeRound([margin.left, width - margin.right]);

      const y = d3
        .scaleBand()
        .domain(bias.map(([name]) => name))
        .rangeRound([margin.top, height - margin.bottom])
        .padding(2 / 33);

      const formatValue = () => {
        const format = d3.format(options.format || "");
        return (x) => format(Math.abs(x));
      };

      const xAxis = (g) =>
        g
          .attr("transform", `translate(0,${margin.top})`)
          .call(
            d3
              .axisTop(x)
              .ticks(Math.ceil(maxCountOfAType))
              .tickFormat(formatValue())
              .tickSizeOuter(0)
          )
          .call((g) => g.select(".domain").remove())
          .call((g) =>
            g
              .append("text")
              .attr("x", x(0) + 20)
              .attr("y", -24)
              .attr("fill", "currentColor")
              .attr("text-anchor", "start")
              .text(options.positive)
          )
          .call((g) =>
            g
              .append("text")
              .attr("x", x(0) - 20)
              .attr("y", -24)
              .attr("fill", "currentColor")
              .attr("text-anchor", "end")
              .text(options.negative)
          );

      const yAxis = (g) =>
        g
          .call(d3.axisLeft(y).tickSizeOuter(0))
          .call((g) =>
            g
              .selectAll(".tick")
              .data(bias)
              .attr(
                "transform",
                ([name, min]) => `translate(${x(min)},${y(name) + y.bandwidth() / 2})`
              )
          )
          .call((g) => g.select(".domain").attr("transform", `translate(${x(0)},0)`));

      const chart = () => {
        const svg = d3.create("svg").attr("viewBox", [0, 0, width, height]);

        svg
          .append("g")
          .selectAll("g")
          .data(series)
          .join("g")
          .attr("fill", (d) => getColor(d.key))
          .selectAll("rect")
          .data((d) => d.map((v) => Object.assign(v, { key: d.key })))
          .join("rect")
          .attr("x", (d) => x(d[0]))
          .attr("y", ({ data: [name] }) => y(name))
          .attr("width", (d) => x(d[1]) - x(d[0]))
          .attr("height", y.bandwidth())
          .append("title")
          .text(
            ({ key, data: [name, value] }) => `${name}
      ${formatValue(value.get(key))} ${key}`
          );

        svg.append("g").call(xAxis);

        svg.append("g").call(yAxis);

        return svg.node();
      };

      //document.body.appendChild(chart());
      var test = document.getElementById("d3app");
      test.appendChild(chart());
*/
    </script>
  </body>
</html>