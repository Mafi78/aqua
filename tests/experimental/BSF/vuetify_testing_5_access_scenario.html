<!doctype html>
<html>
  <head>
    <link
      href="https://cdn.jsdelivr.net/npm/@mdi/font@4.x/css/materialdesignicons.min.css"
      rel="stylesheet"
    />
    <link href="https://cdn.jsdelivr.net/npm/vuetify@3.0.5/dist/vuetify.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
  </head>
  <body>
    <script type="module">
      window.addEventListener('DOMContentLoaded', () =>
        import('https://unpkg.com/mathlive?module').then((mathlive) =>
          mathlive.renderMathInDocument()
        )
      )
    </script>
    <div id="app"></div>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vuetify@3.0.5/dist/vuetify.min.js"></script>
    <script type="text/x-template" id="app-template">
      <v-app>
        <v-layout class="rounded rounded-md">
          <v-navigation-drawer
            image="https://cdn.vuetifyjs.com/images/backgrounds/bg-2.jpg"
            theme="dark"
            permanent
            :rail="v_rail"
            >
            <v-list nav>
              <v-list-item prepend-icon="mdi-home" title="Home" value="Home" @click.stop="v_rail = !v_rail"></v-list-item>
              <v-list-item prepend-icon="mdi-file-cabinet" title="Access Scenario" value="AccessScenario" @click.stop="v_rail = !v_rail"></v-list-item>
              <v-list-item prepend-icon="mdi-movie-open" title="Run a Scenario" value="RunScenario" @click.stop="v_rail = !v_rail"></v-list-item>
              <v-list-item prepend-icon="mdi-run-fast" title="Prepare on-the-go" value="OnTheGo"  @click.stop="v_rail = !v_rail"></v-list-item>
              <v-list-item prepend-icon="mdi-database-edit" title="Work on a Database" value="WorkOnDatabase"  @click.stop="v_rail = !v_rail"></v-list-item>
              <v-list-item prepend-icon="mdi-book-open-outline" title="Access Documentation" value="AccessDocumentation" @click.stop="testMethod"></v-list-item>
              <v-list-item prepend-icon="mdi-handshake" title="Culture Hints" value="CultureHints" @click.stop="testMethod"></v-list-item>
              <v-list-item prepend-icon="mdi-unfold-more-vertical" title="" value="ExpandMinimize" @click.stop="testMethod"></v-list-item>
            </v-list>
          </v-navigation-drawer>

          <!--v-app-bar title="Application bar"></v-app-bar-->
          <v-main class="d-flex "> <!-- align-center justify-center -->
            <!--Main Content-->
            <v-container class="white">
              <v-row>
                <v-col cols="12" class="bg-white">
                  <v-breadcrumbs :items="['SCENARIO NAME', 'USES DATABASE', '<DATABASE NAME>', 'V.y.z']">
                  </v-breadcrumbs>
                </v-col>
              </v-row>
              <v-row class="mb-3" no-gutters>
                <v-col cols="2" class="bg-red">
                  Origin column
                  <v-table density="compact">
                    <tbody>
                      <tr>
                        <v-select density="compact" label="Select Sender" :items="['Country A', 'Region A', 'City A']"></v-select>
                        <v-select density="compact" label="Select Receiver" :items="['Country B', 'Region B', 'City B']"></v-select>
                      </tr>
                      <tr>Variation name here</tr>
                      <tr><div class="text-center">
                        <v-pagination
                        density="compact"
                        v-model="page"
                          :length="2"
                          next-icon="mdi-menu-right"
                          prev-icon="mdi-menu-left"
                        ></v-pagination>
                      </div>
                    </tr>
                      <tr>
                        <v-btn block prepend-icon="mdi-file-edit" :ripple="true" density="comfortable">
                          <template v-slot:prepend>
                            <v-icon color="black"></v-icon>
                            <v-tooltip
                            activator="parent"
                            location="top"
                          >Open and work on scenario</v-tooltip>
                          EDIT SCENARIO
                          </template>
                        </v-btn>
                      </tr>
                    </t-body>
                  </v-table>
                </v-col>
                <v-col cols="4" class="bg-blue">
                  Gap Chart column
                  <v-col cols="12">
                    <div id="d3app"> </div>
                  </v-col>
                </v-col>
                <v-col cols="2" class="bg-grey">
                  Risk level column
                  <v-table density="compact">
                    <thead>
                      <tr>
                        <th class="text-left">
                          Risk Level
                        </th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td>Elevated</td>
                      </tr>
                      <tr>
                        <td>High</td>
                      </tr>
                      <tr>
                        <td>High</td>
                      </tr>
                      <tr>
                        <td>High</td>
                      </tr>
                      <tr>
                        <td>High</td>
                      </tr>
                      <tr>
                        <td>High</td>
                      </tr>
                      <tr>
                        <td>High</td>
                      </tr><tr>
                        <td>High</td>
                      </tr>
                    </tbody>
                  </v-table>
                </v-col>
                <v-col cols="3" class="bg-green">
                  Notes column
                  <v-textarea
                          density="compact"
                          :model-value="value"
                          label="Notes"
                          rows="1"
                          no-resize
                          bg-color="white"
                        ></v-textarea>
                </v-col>
                <v-col cols="1" class="bg-yellow">
                  Icon column
                  <v-spacer></v-spacer>
                  <v-btn density="comfortable" icon="mdi-printer" :ripple="true">
                    <v-icon color="black"></v-icon>
                      <v-tooltip
                    activator="parent"
                    location="top"
                  >Print</v-tooltip>
                  </v-btn>
                  <v-spacer></v-spacer>
                  <v-btn density="comfortable" icon="mdi-share" :ripple="true">
                    <v-icon color="black"></v-icon>
                      <v-tooltip
                    activator="parent"
                    location="top"
                  >Share</v-tooltip>
                  </v-btn>
                </v-col>
              </v-row>
              <v-col cols="12" class="bg-orange">
                Results overview
                <v-sheet>
                  Miscommunication: Cumulative and Incremental
                  <v-table density="compact">
                    <thead>
                      <tr>
                        <th class="text-left">
                          Cumulative Probability
                        </th>
                        <th class="text-left">
                          ...
                        </th>
                        <th class="text-left">
                          Shared understanding
                        </th>
                        <th class="text-left">
                          Performance feedback
                        </th>
                        <th class="text-left">
                          Influencing narrative
                        </th>
                        <th class="text-left">
                          Leadership style
                        </th>
                        <th class="text-left">
                          Decision-making
                        </th>
                        <th class="text-left">
                          Relationship foundation
                        </th>
                        <th class="text-left">
                          Conflict resolution
                        </th>
                        <th class="text-left">
                          Time management
                        </th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td>Elevated</td>
                        <td></td>
                        <td>risk level</td>
                        <td>risk level</td>
                        <td>risk level</td>
                        <td>risk level</td>
                        <td>risk level</td>
                        <td>risk level</td>
                        <td>risk level</td>
                        <td>risk level</td>
                      </tr>
                      <tr>
                        <td>66%</td>
                        <td></td>
                        <td>x%</td>
                        <td>x%</td>
                        <td>x%</td>
                        <td>x%</td>
                        <td>x%</td>
                        <td>x%</td>
                        <td>x%</td>
                        <td>x%</td>
                      </tr>
                      <tr>
                        <td></td>
                        <td></td>
                        <td>weight: 1.0</td>
                        <td>weight: 1.0</td>
                        <td>weight: 1.0</td>
                        <td>weight: 1.0</td>
                        <td>weight: 1.0</td>
                        <td>weight: 1.0</td>
                        <td>weight: 1.0</td>
                        <td>weight: 1.0</td>
                      </tr>
                    </tbody>
                  </v-table>
                </v-sheet>
              </v-col>
            </v-container>
          </v-main>
        </v-layout>
      </v-app>
    </script>
    <script>
      // Vue Section
      const { createApp } = Vue
      const { createVuetify } = Vuetify

      const vuetify = createVuetify()
      const app = createApp({
        template: '#app-template',
        data() {
          return {
            v_rail: false
          }
        },
        /*computed: {
          items() {
            return this.$store.state.items;
          },
          name() {
            return this.$store.state.name;
          }
        },*/
        methods: {
          testMethod() {
            console.log('Dies ist ein Test')
            this.v_rail = !this.v_rail
          } /*,
          boop() {
            console.log('booop');
            console.log('test', this.test);
          },*/
        }
      })
        .use(vuetify)
        .mount('#app')
    </script>
    <script>
      var testdate = [
        {
          rating: 1,
          items: ['Duration']
        },
        {
          rating: 3,
          items: ['Duration']
        },
        {
          rating: 3,
          items: ['Duration']
        },
        {
          rating: 5,
          items: ['Duration']
        },
        {
          rating: 5,
          items: ['Duration']
        },
        {
          rating: 1,
          items: ['Duration']
        },
        {
          rating: 4,
          items: ['Duration', 'Testing']
        },
        {
          rating: 4,
          items: ['Audience']
        },
        {
          rating: 1,
          items: ['Audience']
        },
        {
          rating: 5,
          items: ['Reasoning', 'Reasoning']
        },
        {
          rating: 2,
          items: ['Audience', 'Reasoning', 'Duration', 'Slides']
        },
        {
          rating: 1,
          items: ['Duration', 'Slides']
        },
        {
          rating: 4,
          items: ['Audience', 'Slides']
        },
        {
          rating: 5,
          items: ['Reasoning']
        },
        {
          rating: 2,
          items: ['Speed', 'Reasoning']
        },
        {
          rating: 5,
          items: ['Slides', 'Audience']
        },
        {
          rating: 3,
          items: ['Slides']
        },
        {
          rating: 1,
          items: ['Speed', 'Duration', 'Slides']
        },
        {
          rating: 5,
          items: ['Agenda', 'Slides']
        },
        {
          rating: 5,
          items: ['Speed', 'Audience']
        },
        {
          rating: 3,
          items: ['Speed', 'Tone']
        },
        {
          rating: 5,
          items: ['Tone', 'Slides']
        },
        {
          rating: 6,
          items: ['Tone', 'Slides']
        },
        {
          rating: 6,
          items: ['Testing']
        }
      ]

      // reshape data
      //const data = getData().reduce((result, { rating, items }) => {
      const data = testdate.reduce((result, { rating, items }) => {
        return items.reduce((res, item) => {
          const foundIndex = res.findIndex((r) => r.name === item && r.category === rating)

          if (foundIndex !== -1) {
            res[foundIndex].value++
            return res
          }
          return [...res, { name: item, category: rating, value: 1 }]
        }, result)
      }, [])

      const options = {
        format: '',
        negative: '← Do less',
        positive: 'Do more →',
        negatives: [1, 2, 3, 4],
        positives: [5, 6],
        colors: {
          1: '#63171B',
          2: '#F56565',
          3: '#ED8936',
          4: '#ECC94B',
          5: '#48BB78',
          6: '#00FF00'
        }
      }

      const maxCountOfTypes = data.reduce((result, { name, value }) => {
        result[name] = value + (result[name] ? result[name] : 0)
        return result
      }, {})
      const maxCountOfAType = Math.max(...Object.values(maxCountOfTypes))

      const width = 750

      const margin = { top: 50, right: 30, bottom: 0, left: 80 }
      const signs = new Map([
        ...options.negatives.map((d) => [d, -1]),
        ...options.positives.map((d) => [d, +1])
      ])
      const series = d3
        .stack()
        .keys([].concat(options.negatives.slice().reverse(), options.positives))
        .value(([, value], category) => signs.get(category) * (value.get(category) || 0))
        .offset(d3.stackOffsetDiverging)(
        d3.rollups(
          data,
          (data) =>
            d3.rollup(
              data,
              ([d]) => d.value,
              (d) => d.category
            ),
          (d) => d.name
        )
      )

      const bias = d3
        .rollups(
          data,
          (v) => d3.sum(v, (d) => d.value * Math.min(0, signs.get(d.category))),
          (d) => d.name
        )
        .sort(([, a], [, b]) => d3.ascending(a, b))

      const height = bias.length * 33 + margin.top + margin.bottom

      const getColor = (key) => {
        return options.colors[key]
      }

      const x = d3
        .scaleLinear()
        .domain(d3.extent(series.flat(2)))
        .rangeRound([margin.left, width - margin.right])

      const y = d3
        .scaleBand()
        .domain(bias.map(([name]) => name))
        .rangeRound([margin.top, height - margin.bottom])
        .padding(2 / 33)

      const formatValue = () => {
        const format = d3.format(options.format || '')
        return (x) => format(Math.abs(x))
      }

      const xAxis = (g) =>
        g
          .attr('transform', `translate(0,${margin.top})`)
          .call(
            d3
              .axisTop(x)
              .ticks(Math.ceil(maxCountOfAType))
              .tickFormat(formatValue())
              .tickSizeOuter(0)
          )
          .call((g) => g.select('.domain').remove())
          .call((g) =>
            g
              .append('text')
              .attr('x', x(0) + 20)
              .attr('y', -24)
              .attr('fill', 'currentColor')
              .attr('text-anchor', 'start')
              .text(options.positive)
          )
          .call((g) =>
            g
              .append('text')
              .attr('x', x(0) - 20)
              .attr('y', -24)
              .attr('fill', 'currentColor')
              .attr('text-anchor', 'end')
              .text(options.negative)
          )

      const yAxis = (g) =>
        g
          .call(d3.axisLeft(y).tickSizeOuter(0))
          .call((g) =>
            g
              .selectAll('.tick')
              .data(bias)
              .attr(
                'transform',
                ([name, min]) => `translate(${x(min)},${y(name) + y.bandwidth() / 2})`
              )
          )
          .call((g) => g.select('.domain').attr('transform', `translate(${x(0)},0)`))

      const chart = () => {
        const svg = d3.create('svg').attr('viewBox', [0, 0, width, height])

        svg
          .append('g')
          .selectAll('g')
          .data(series)
          .join('g')
          .attr('fill', (d) => getColor(d.key))
          .selectAll('rect')
          .data((d) => d.map((v) => Object.assign(v, { key: d.key })))
          .join('rect')
          .attr('x', (d) => x(d[0]))
          .attr('y', ({ data: [name] }) => y(name))
          .attr('width', (d) => x(d[1]) - x(d[0]))
          .attr('height', y.bandwidth())
          .append('title')
          .text(
            ({ key, data: [name, value] }) => `${name}
      ${formatValue(value.get(key))} ${key}`
          )

        svg.append('g').call(xAxis)

        svg.append('g').call(yAxis)

        return svg.node()
      }

      //document.body.appendChild(chart());
      var test = document.getElementById('d3app')
      test.appendChild(chart())
    </script>
  </body>
</html>
